<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Dashboard - SpaceX crypto</title>
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <script
      type="module"
      src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Fcryptovaul9343back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.9"
    ></script>
    <script
      type="module"
      src="https://static.rocket.new/rocket-shot.js?v=0.0.1"
    ></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Ensure the notification block is styled correctly */
      #actionNotification {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 100;
        min-width: 300px;
      }
    </style>
  </head>
  <body class="bg-background min-h-screen">
    <header class="w-full py-6 px-4 border-b border-border-subtle">
      <div class="max-w-7xl mx-auto flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <div
            class="w-10 h-10 bg-gradient-to-br from-primary to-secondary rounded-lg flex items-center justify-center"
          >
            <svg
              class="w-6 h-6 text-white"
              fill="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
              />
            </svg>
          </div>
          <div>
            <h1 class="text-2xl font-bold text-gradient-primary">SpaceX</h1>
            <p class="text-xs text-text-secondary">SpaceX Crypto</p>
          </div>
        </div>

        <div class="flex items-center space-x-4">
          <div class="relative">
            <button
              id="profileDropdown"
              class="flex items-center space-x-2 bg-surface border border-border-subtle rounded-lg px-3 py-2 hover:bg-surface-700 transition-colors"
            >
              <div
                class="w-8 h-8 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center"
              >
                <svg
                  class="w-4 h-4 text-white"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    fill-rule="evenodd"
                    d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
                    clip-rule="evenodd"
                  />
                </svg>
              </div>
              <span class="text-text-primary text-sm" id="usernameDisplay"
                >User</span
              >
              <svg
                class="w-4 h-4 text-text-secondary"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 9l-7 7-7-7"
                />
              </svg>
            </button>

            <div
              id="profileMenu"
              class="hidden absolute right-0 mt-2 w-48 bg-surface border border-border-subtle rounded-lg shadow-lg z-50"
            >
              <div class="py-2">
                <a
                  href="user_profile_settings.html"
                  class="block px-4 py-2 text-sm text-text-primary hover:bg-surface-700 transition-colors"
                >
                  <div class="flex items-center space-x-2">
                    <svg
                      class="w-4 h-4"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
                      />
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                      />
                    </svg>
                    <span>Profile Settings</span>
                  </div>
                </a>
                <a
                  href="javascript:void(0)"
                  onclick="logout()"
                  class="block px-4 py-2 text-sm text-error hover:bg-surface-700 transition-colors"
                >
                  <div class="flex items-center space-x-2">
                    <svg
                      class="w-4 h-4"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"
                      />
                    </svg>
                    <span>Logout</span>
                  </div>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main class="max-w-7xl mx-auto p-4 md:p-8">
      <h2 class="text-3xl font-bold text-text-primary mb-6">Dashboard</h2>

      <div id="actionNotification" class="hidden"></div>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div
          class="bg-card p-6 rounded-xl shadow-lg border border-border-subtle"
        >
          <h3 class="text-lg font-medium text-text-secondary mb-2">
            Available Balance
          </h3>
          <p id="availableBalance" class="text-4xl font-bold text-text-primary">
            $0.00
          </p>
          <p class="text-sm text-green-400 mt-1 flex items-center">
            <svg
              class="w-4 h-4 mr-1"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"
              ></path>
            </svg>
            Ready for trading
          </p>
        </div>

        <div
          class="bg-card p-6 rounded-xl shadow-lg border border-border-subtle"
        >
          <h3 class="text-lg font-medium text-text-secondary mb-2">
            Total Portfolio Value
          </h3>
          <p id="totalAssets" class="text-4xl font-bold text-text-primary">
            $0.00
          </p>
          <p class="text-sm text-text-secondary mt-1">Includes all holdings</p>
        </div>

        <div
          class="bg-card p-6 rounded-xl shadow-lg border border-border-subtle"
        >
          <h3 class="text-lg font-medium text-text-secondary mb-2">
            Locked Funds
          </h3>
          <p id="lockedBalance" class="text-4xl font-bold text-text-primary">
            $0.00
          </p>
          <p class="text-sm text-red-400 mt-1">Pending transactions</p>
        </div>
      </div>
      <section class="mb-8">
        <h3 class="text-xl font-semibold text-text-primary mb-6">
          Quick Actions
        </h3>
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
          <button
            onclick="handleAction('deposit')"
            class="card hover:bg-surface-700 transition-all duration-200 hover:scale-105 text-center"
          >
            <div
              class="w-16 h-16 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center mx-auto mb-3"
            >
              <svg
                class="w-8 h-8 text-white"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 6v6m0 0v6m0-6h6m-6 0H6"
                />
              </svg>
            </div>
            <p class="text-text-primary font-medium">Deposit</p>
          </button>

          <button
            onclick="handleAction('withdraw')"
            class="card hover:bg-surface-700 transition-all duration-200 hover:scale-105 text-center"
          >
            <div
              class="w-16 h-16 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center mx-auto mb-3"
            >
              <svg
                class="w-8 h-8 text-white"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M20 12H4m16 0l-4-4m4 4l-4 4"
                />
              </svg>
            </div>
            <p class="text-text-primary font-medium">Withdraw</p>
          </button>

          <button
            onclick="handleAction('transaction')"
            class="card hover:bg-surface-700 transition-all duration-200 hover:scale-105 text-center"
          >
            <div
              class="w-16 h-16 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center mx-auto mb-3"
            >
              <svg
                class="w-8 h-8 text-white"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                />
              </svg>
            </div>
            <p class="text-text-primary font-medium">Transaction</p>
          </button>

          <button
            onclick="handleAction('pledge')"
            class="card hover:bg-surface-700 transition-all duration-200 hover:scale-105 text-center"
          >
            <div
              class="w-16 h-16 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center mx-auto mb-3"
            >
              <svg
                class="w-8 h-8 text-white"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
                />
              </svg>
            </div>
            <p class="text-text-primary font-medium">Pledge</p>
          </button>

          <button
            onclick="handleAction('transfer')"
            class="card hover:bg-surface-700 transition-all duration-200 hover:scale-105 text-center"
          >
            <div
              class="w-16 h-16 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center mx-auto mb-3"
            >
              <svg
                class="w-8 h-8 text-white"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"
                />
              </svg>
            </div>
            <p class="text-text-primary font-medium">Transfer</p>
          </button>

          <button
            onclick="handleAction('defi')"
            class="card hover:bg-surface-700 transition-all duration-200 hover:scale-105 text-center"
          >
            <div
              class="w-16 h-16 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center mx-auto mb-3"
            >
              <svg
                class="w-8 h-8 text-white"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 10V3L4 14h7v7l9-11h-7z"
                />
              </svg>
            </div>
            <p class="text-text-primary font-medium">DeFi Mining</p>
          </button>
        </div>
      </section>

      <div
        class="bg-card p-6 rounded-xl shadow-lg border border-border-subtle mb-8"
        id="transactionForms"
      >
        <h3 class="text-2xl font-bold text-text-primary mb-4">
          Withdrawal & Buy Actions
        </h3>
        <div class="flex flex-col md:flex-row gap-6">
          <div class="md:w-1/2" id="withdrawSection">
            <h4 class="text-xl font-semibold text-text-primary mb-2">
              Request Withdrawal
            </h4>
            <form id="withdrawForm" class="space-y-4">
              <input
                type="number"
                id="withdrawAmount"
                min="0.01"
                step="0.01"
                placeholder="Amount to Withdraw"
                required
                class="w-full bg-background border border-border-subtle rounded-lg text-text-primary p-2 focus:ring-2 focus:ring-primary focus:border-primary"
              />
              <input
                type="text"
                id="walletAddress"
                placeholder="Your Crypto Wallet Address (e.g., ERC20, BTC)"
                required
                class="w-full bg-background border border-border-subtle rounded-lg text-text-primary p-2 focus:ring-2 focus:ring-primary focus:border-primary"
              />
              <button
                type="submit"
                id="withdrawSubmitButton"
                class="w-full btn-primary flex-shrink-0 bg-red-600 hover:bg-red-700"
              >
                Submit Withdrawal Request
              </button>
            </form>
          </div>

          <div class="md:w-1/2">
            <h4 class="text-xl font-semibold text-text-primary mb-2">
              Buy Crypto
            </h4>
            <form id="buyForm" class="flex space-x-2">
              <input
                type="number"
                id="buyAmount"
                min="0.01"
                step="0.01"
                placeholder="Amount to Buy (USD)"
                required
                class="w-full bg-background border border-border-subtle rounded-lg text-text-primary p-2 focus:ring-2 focus:ring-primary focus:border-primary"
              />
              <button
                type="submit"
                class="btn-primary flex-shrink-0 bg-indigo-600 hover:bg-indigo-700"
              >
                Buy
              </button>
            </form>
            <div class="mt-4 text-sm text-text-secondary">
                For deposits, please use the "Deposit" quick action button above.
            </div>
          </div>
        </div>
      </div>

      <div>
        <h4 class="text-lg font-semibold text-text-primary mb-4">
          Market Overview
        </h4>
        <div class="space-y-3">
          <div
            class="flex items-center justify-between p-3 bg-surface-700 rounded-lg"
          >
            <div class="flex items-center space-x-3">
              <img
                src="https://images.unsplash.com/photo-1629788962818-3b5127bc6a5a"
                alt="Bitcoin cryptocurrency coin with golden color"
                class="w-8 h-8 rounded-full object-cover"
                onerror="this.src='https://images.unsplash.com/photo-1518546305927-5a555bb7020d?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'; this.onerror=null;"
              />
              <div>
                <p class="text-text-primary font-medium">BTC</p>
                <p class="text-text-secondary text-xs">Bitcoin</p>
              </div>
            </div>
            <div class="text-right">
              <p class="text-text-primary font-semibold">$67,234.50</p>
              <p class="text-success text-xs">+3.24%</p>
            </div>
          </div>
          <div
            class="flex items-center justify-between p-3 bg-surface-700 rounded-lg"
          >
            <div class="flex items-center space-x-3">
              <img
                src="https://images.unsplash.com/photo-1621570183183-f368f5c093a8"
                alt="Ethereum cryptocurrency coin with golden color"
                class="w-8 h-8 rounded-full object-cover"
                onerror="this.src='https://images.pexels.com/photos/8436582/pexels-photo-8436582.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2'; this.onerror=null;"
              />
              <div>
                <p class="text-text-primary font-medium">ETH</p>
                <p class="text-text-secondary text-xs">Ethereum</p>
              </div>
            </div>
            <div class="text-right">
              <p class="text-text-primary font-semibold">$3,450.21</p>
              <p class="text-error text-xs">-1.55%</p>
            </div>
          </div>
        </div>
      </div>

      <section class="mb-8 mt-8">
        <h3 class="text-xl font-semibold text-text-primary mb-6">
          Investment Plans
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="card-elevated border-l-4 border-success">
            <div class="flex items-center justify-between mb-4">
              <div class="flex items-center space-x-3">
                <div
                  class="w-12 h-12 bg-success bg-opacity-20 rounded-full flex items-center justify-center"
                >
                  <img
                    src="https://images.unsplash.com/photo-1629788962818-3b5127bc6a5a"
                    alt="Bitcoin cryptocurrency coin for 1-day investment plan"
                    class="w-6 h-6 rounded-full object-cover"
                    onerror="this.src='https://images.pexels.com/photos/730547/pexels-photo-730547.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2'; this.onerror=null;"
                  />
                </div>
                <div>
                  <h4 class="text-lg font-semibold text-text-primary">
                    1-Day BTC Lock
                  </h4>
                  <p class="text-text-secondary text-sm">Daily investment</p>
                </div>
              </div>
              <div class="text-right">
                <p class="text-success text-xl font-bold">2.5%</p>
                <p class="text-text-secondary text-xs">Daily Return</p>
              </div>
            </div>
            <div class="space-y-3 mb-4">
              <div class="flex justify-between">
                <span class="text-text-secondary">Minimum Investment:</span>
                <span class="text-text-primary font-semibold">$100.00</span>
              </div>
              <div class="flex justify-between">
                <span class="text-text-secondary">Lock Period:</span>
                <span class="text-text-primary font-semibold">1 Day</span>
              </div>
              <div class="flex justify-between">
                <span class="text-text-secondary">Expected Return:</span>
                <span class="text-success font-semibold">$102.50</span>
              </div>
            </div>
            <button
              onclick="investInPlan('1day', 100)"
              class="w-full btn-secondary"
            >
              Invest Now
            </button>
          </div>

          <div class="card-elevated border-l-4 border-primary">
            <div class="flex items-center justify-between mb-4">
              <div class="flex items-center space-x-3">
                <div
                  class="w-12 h-12 bg-primary bg-opacity-20 rounded-full flex items-center justify-center"
                >
                  <img
                    src="https://images.unsplash.com/photo-1626163015484-81fc7e3b90d8"
                    alt="Tether USDT symbol for 7-day investment plan"
                    class="w-6 h-6 rounded-full object-cover"
                    onerror="this.src='https://images.pexels.com/photos/730547/pexels-photo-730547.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2'; this.onerror=null;"
                  />
                </div>
                <div>
                  <h4 class="text-lg font-semibold text-text-primary">
                    7-Day USDT Lock
                  </h4>
                  <p class="text-text-secondary text-sm">Weekly investment</p>
                </div>
              </div>
              <div class="text-right">
                <p class="text-primary text-xl font-bold">18.5%</p>
                <p class="text-text-secondary text-xs">Weekly Return</p>
              </div>
            </div>
            <div class="space-y-3 mb-4">
              <div class="flex justify-between">
                <span class="text-text-secondary">Minimum Investment:</span>
                <span class="text-text-primary font-semibold">$1,000.00</span>
              </div>
              <div class="flex justify-between">
                <span class="text-text-secondary">Lock Period:</span>
                <span class="text-text-primary font-semibold">7 Days</span>
              </div>
              <div class="flex justify-between">
                <span class="text-text-secondary">Expected Return:</span>
                <span class="text-primary font-semibold">$1,185.00</span>
              </div>
            </div>
            <button
              onclick="investInPlan('7day', 1000)"
              class="w-full btn-primary"
            >
              Invest Now
            </button>
          </div>
          <div class="card-elevated border-l-4 border-indigo-500">
            <div class="flex items-center justify-between mb-4">
              <div class="flex items-center space-x-3">
                <div
                  class="w-12 h-12 bg-indigo-500 bg-opacity-20 rounded-full flex items-center justify-center"
                >
                  <svg
                    class="w-6 h-6 text-indigo-400"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 8c-2.035 0-3.95.836-5.32 2.216m10.64 0c-1.37-1.38-3.285-2.216-5.32-2.216s-3.95.836-5.32 2.216m10.64 0c1.37 1.38 2.216 3.295 2.216 5.32s-.846 3.95-2.216 5.32M7.68 10.216c-1.37 1.38-2.216 3.295-2.216 5.32s.846 3.95 2.216 5.32"
                    ></path>
                  </svg>
                </div>
                <div>
                  <h4 class="text-lg font-semibold text-text-primary">
                    30-Day ETH Lock
                  </h4>
                  <p class="text-text-secondary text-sm">Monthly investment</p>
                </div>
              </div>
              <div class="text-right">
                <p class="text-indigo-400 text-xl font-bold">85%</p>
                <p class="text-text-secondary text-xs">Monthly Return</p>
              </div>
            </div>
            <div class="space-y-3 mb-4">
              <div class="flex justify-between">
                <span class="text-text-secondary">Minimum Investment:</span>
                <span class="text-text-primary font-semibold">$5,000.00</span>
              </div>
              <div class="flex justify-between">
                <span class="text-text-secondary">Lock Period:</span>
                <span class="text-text-primary font-semibold">30 Days</span>
              </div>
              <div class="flex justify-between">
                <span class="text-text-secondary">Expected Return:</span>
                <span class="text-indigo-400 font-semibold">$9,250.00</span>
              </div>
            </div>
            <button
              onclick="investInPlan('30day', 5000)"
              class="w-full btn-secondary bg-indigo-600 hover:bg-indigo-700 text-white"
            >
              Invest Now
            </button>
          </div>
        </div>
      </section>

      <section class="mb-8">
        <div
          class="card-elevated bg-gradient-to-r from-primary to-secondary relative overflow-hidden"
        >
          <div class="relative z-10 flex items-center justify-between">
            <div>
              <h3 class="text-2xl font-bold text-white mb-2">
                LIQUIDITY MINING
              </h3>
              <p class="text-white text-lg mb-4">EARN HIGH INCOME</p>
              <button
                onclick="handleAction('liquidity')"
                class="bg-white text-primary font-bold py-2 px-4 rounded-lg hover:bg-gray-100 transition-colors"
              >
                Learn More
              </button>
            </div>
            <svg
              class="absolute -top-10 -right-10 w-48 h-48 opacity-20 text-white"
              fill="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
              />
            </svg>
          </div>
        </div>
      </section>

      <div class="mb-8" id="transactionHistory">
        <h3 class="text-xl font-semibold text-text-primary mb-6">
          Transaction History
        </h3>
        <div
          class="overflow-x-auto bg-card rounded-xl shadow-lg border border-border-subtle"
        >
          <table class="min-w-full divide-y divide-border-subtle">
            <thead>
              <tr>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider"
                >
                  Date
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider"
                >
                  Type
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider"
                >
                  Amount
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider"
                >
                  Status
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider"
                >
                  ID
                </th>
              </tr>
            </thead>
            <tbody
              id="transactionTableBody"
              class="bg-card divide-y divide-border-subtle text-text-primary"
            >
              </tbody>
          </table>
          <div
            id="noTransactions"
            class="p-4 text-center text-text-secondary"
          >
            No transactions found.
          </div>
        </div>
      </div>

      <section class="mb-8">
        <h3 class="text-xl font-semibold text-text-primary mb-6">
          Current Investments
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="card-elevated border-l-4 border-success">
            <div class="flex items-center justify-between mb-4">
              <div>
                <h4 class="text-lg font-semibold text-text-primary">
                  7-Day USDT Lock
                </h4>
                <p class="text-text-secondary text-sm">Started: Oct 29, 2025</p>
              </div>
              <div class="text-right">
                <span
                  class="bg-success bg-opacity-20 text-success px-3 py-1 rounded-full text-sm font-medium"
                >
                  Active
                </span>
              </div>
            </div>
            <div class="space-y-3 mb-4">
              <div class="flex justify-between">
                <span class="text-text-secondary">Investment Amount:</span>
                <span class="text-text-primary font-semibold">$1,000.00</span>
              </div>
              <div class="flex justify-between">
                <span class="text-text-secondary">Current Profit:</span>
                <span class="text-success font-semibold">+$45.50</span>
              </div>
              <div class="flex justify-between">
                <span class="text-text-secondary">Expected Return:</span>
                <span class="text-primary font-semibold">$1,185.00</span>
              </div>
              <div class="flex justify-between">
                <span class="text-text-secondary">Time Remaining:</span>
                <span class="text-text-primary font-semibold"
                  >6 days 14h</span
                >
              </div>
            </div>
            <div class="mb-4">
              <div class="flex justify-between text-sm mb-1">
                <span class="text-text-secondary">Progress</span>
                <span class="text-primary font-semibold">50%</span>
              </div>
              <div class="w-full bg-border-subtle rounded-full h-2">
                <div
                  class="bg-primary h-2 rounded-full"
                  style="width: 50%"
                ></div>
              </div>
            </div>
          </div>
          <div class="card-elevated border-l-4 border-yellow-500">
            <div class="flex items-center justify-between mb-4">
              <div>
                <h4 class="text-lg font-semibold text-text-primary">
                  1-Day BTC Lock
                </h4>
                <p class="text-text-secondary text-sm">Started: Today</p>
              </div>
              <div class="text-right">
                <span
                  class="bg-yellow-500 bg-opacity-20 text-yellow-500 px-3 py-1 rounded-full text-sm font-medium"
                >
                  Pending
                </span>
              </div>
            </div>
            <div class="space-y-3 mb-4">
              <div class="flex justify-between">
                <span class="text-text-secondary">Investment Amount:</span>
                <span class="text-text-primary font-semibold">$100.00</span>
              </div>
              <div class="flex justify-between">
                <span class="text-text-secondary">Current Profit:</span>
                <span class="text-success font-semibold">+$0.00</span>
              </div>
              <div class="flex justify-between">
                <span class="text-text-secondary">Expected Return:</span>
                <span class="text-success font-semibold">$102.50</span>
              </div>
              <div class="flex justify-between">
                <span class="text-text-secondary">Time Remaining:</span>
                <span class="text-text-primary font-semibold"
                  >23 hours 59m</span
                >
              </div>
            </div>
            <div class="mb-4">
              <div class="flex justify-between text-sm mb-1">
                <span class="text-text-secondary">Progress</span>
                <span class="text-yellow-500 font-semibold">0%</span>
              </div>
              <div class="w-full bg-border-subtle rounded-full h-2">
                <div
                  class="bg-yellow-500 h-2 rounded-full"
                  style="width: 0%"
                ></div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer
      class="w-full py-6 px-4 border-t border-border-subtle mt-8 bg-card"
    >
      <div
        class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center text-center md:text-left"
      >
        <p class="text-sm text-text-secondary">
          &copy; 2025 SpaceX Crypto. All Rights Reserved. |
          <a
            href="javascript:void(0)"
            class="text-primary hover:text-secondary transition-colors"
            >Privacy Policy</a
          >
          |
          <a
            href="javascript:void(0)"
            class="text-primary hover:text-secondary transition-colors"
            >Terms of Service</a
          >
        </p>
      </div>
    </footer>
    <script>
      const API_BASE_URL = "https://spacex-tkks.onrender.com/api";
      const token = localStorage.getItem("token");
      const userId = localStorage.getItem("userId");
      const userType = localStorage.getItem("userType");
      const username = localStorage.getItem("username");

      // --- UTILITY FUNCTIONS ---
      // Check authentication status and redirect if necessary
      function checkAuth() {
        if (!token || userType !== "user") {
          window.location.href = "user_login.html";
          return false;
        }
        document.getElementById("usernameDisplay").textContent = `Hello, ${username}`;
        return true;
      }

      document
        .getElementById("profileDropdown")
        .addEventListener("click", function (e) {
          e.stopPropagation();
          const menu = document.getElementById("profileMenu");
          menu.classList.toggle("hidden");
        });

      // Close dropdown when clicking outside
      document.addEventListener("click", function () {
        document.getElementById("profileMenu").classList.add("hidden");
      });

      // Function to show action notification (RE-EDITED FOR COOL STYLING)
      function showActionNotification(message, type = "success") {
        const box = document.getElementById("actionNotification");
        box.classList.remove(
          "hidden",
          // Remove old dull color classes
          "bg-red-900", "text-red-300", 
          "bg-green-900", "text-green-300", 
          "bg-yellow-900", "text-yellow-300"
        );
        box.classList.add(
          "p-4", // Bigger padding
          "rounded-xl", // Rounded corners
          "text-lg", // Larger text
          "font-semibold", // Bolder text
          "shadow-xl", // Stronger shadow
          "flex", // Flex layout
          "items-center", // Vertically center content
          "space-x-3", // Spacing for icon
          "transition-all", "duration-300" // Nice transition
        );
        
        let iconHtml = '';
        let colorClasses = '';

        if (type === "success") {
          colorClasses = "bg-green-700/30 text-green-400 border border-green-600/50";
          iconHtml = '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
        } else if (type === "error") {
          colorClasses = "bg-red-700/30 text-red-400 border border-red-600/50";
          iconHtml = '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
        } else if (type === "warning") {
          colorClasses = "bg-yellow-700/30 text-yellow-400 border border-yellow-600/50";
          iconHtml = '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>';
        }

        box.classList.add(...colorClasses.split(' '));
        box.innerHTML = `${iconHtml} <span>${message}</span>`; // Set HTML with icon and message

        setTimeout(() => {
          box.classList.add("hidden");
        }, 5000);
      }

      // Format currency
      const formatter = new Intl.NumberFormat("en-US", {
        style: "currency",
        currency: "USD",
      });

      // --- DATA FETCHING & RENDERING ---
      async function fetchUserData() {
        if (!checkAuth()) return;
        try {
          const response = await fetch(`${API_BASE_URL}/user/data`, {
            headers: {
              Authorization: `Bearer ${token}`,
            },
          });

          if (!response.ok) {
            if (response.status === 401 || response.status === 403) {
              logout();
              return;
            }
            throw new Error("Failed to fetch user data");
          }

          const data = await response.json();
          const { user, transactions } = data;

          // Update metrics
          document.getElementById("availableBalance").textContent =
            formatter.format(user.balance);
          document.getElementById("totalAssets").textContent =
            formatter.format(user.balance); // Simplified for this demo
          
          // Calculate locked balance (sum of pending withdrawals)
          const pendingWithdrawals = transactions.filter(t => t.type === 'withdraw' && t.status === 'pending');
          const lockedWithdrawalAmount = pendingWithdrawals.reduce((sum, t) => sum + t.amount, 0);
          document.getElementById("lockedBalance").textContent = formatter.format(lockedWithdrawalAmount);

          renderTransactionTable(transactions);
        } catch (error) {
          console.error("Error fetching user data:", error);
          // Only show error notification if it's not a temporary 401/403
          if (!error.message.includes("Failed to fetch user data")) {
             showActionNotification("Error connecting to the server. Data refresh failed.", "error");
          }
        }
      }

      function renderTransactionTable(transactions) {
        const tableBody = document.getElementById("transactionTableBody");
        const noTransactions = document.getElementById("noTransactions");
        tableBody.innerHTML = "";

        if (transactions.length === 0) {
          noTransactions.classList.remove("hidden");
        } else {
          noTransactions.classList.add("hidden");
          transactions.forEach((t) => {
            const row = tableBody.insertRow();
            row.className = "hover:bg-gray-800 transition duration-150";

            let statusClass = "status-pending"; // Default
            if (t.status === "complete") {
              statusClass = "status-complete";
            } else if (t.status === "failed") {
              statusClass = "status-failed";
            }

            row.innerHTML = `
              <td class="px-6 py-4 whitespace-nowrap text-sm">${new Date(
                t.date
              ).toLocaleDateString()}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm capitalize">${
                t.type
              }</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium ${
                t.type === "buy" || t.type === "withdraw" ? "text-red-400" : "text-green-400"
              }">${formatter.format(t.amount)}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusClass}">
                  ${t.status}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-xs text-text-secondary">${t.id.substring(
                0,
                8
              )}...</td>
            `;
          });
        }
      }

      // --- TRANSACTION HANDLERS (UPDATED for Wallet Address) ---
      async function handleTransaction(type, amount, walletAddress = null) {
        if (!checkAuth()) return;
        const value = parseFloat(amount);
        if (isNaN(value) || value <= 0) {
          showActionNotification("Please enter a valid amount.", "error");
          return;
        }

        const payload = { type, amount: value };
        if (type === 'withdraw') {
          if (!walletAddress) {
             showActionNotification("Wallet address is required for withdrawal.", "error");
             return;
          }
          payload.walletAddress = walletAddress;
        }

        try {
          const response = await fetch(`${API_BASE_URL}/user/transaction`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`,
            },
            body: JSON.stringify(payload),
          });

          const result = await response.json();

          if (response.ok) {
            showActionNotification(result.message, "success");
            fetchUserData(); // Refresh data and balance
          } else {
            showActionNotification(result.message, "error");
          }
        } catch (error) {
          showActionNotification("An error occurred. Check server connection.", "error");
        }
      }

      // --- NEW WITHDRAWAL SUBMIT HANDLER ---
      document.getElementById("withdrawForm").addEventListener("submit", async function (e) {
        e.preventDefault();
        const amount = document.getElementById("withdrawAmount").value;
        const address = document.getElementById("walletAddress").value.trim();
        const button = document.getElementById("withdrawSubmitButton");
        const originalText = button.textContent;

        if (address === "") {
          showActionNotification("Wallet address cannot be empty.", "warning");
          return;
        }
        
        button.textContent = "Processing...";
        button.disabled = true;

        try {
          // The handleTransaction function will handle the API call and notifications
          await handleTransaction("withdraw", amount, address);
          // Clear form only if successful
          document.getElementById("withdrawAmount").value = '';
          document.getElementById("walletAddress").value = '';

        } finally {
          button.textContent = originalText;
          button.disabled = false;
        }
      });
      
      // --- BUY FORM HANDLER (Now submits transaction instead of just an alert) ---
      document.getElementById("buyForm").addEventListener("submit", function (e) {
        e.preventDefault();
        const amount = document.getElementById("buyAmount").value;
        handleTransaction("buy", amount);
      });

      // --- OTHER ACTION HANDLERS ---
      
      // Handle action buttons
      function handleAction(action) {
        switch (action) {
          case "deposit":
            // Keeping the old alert for admin contact as per original file's design for deposit
            alert('Contact the Admin for your secure deposit on WhatsApp +1 978 505 3319.'); 
            break;
          case "withdraw":
            // SCROLL TO THE NEW WITHDRAW FORM
            document.getElementById('withdrawSection').scrollIntoView({ behavior: 'smooth' }); 
            break;
          case "transaction":
            document.getElementById('transactionHistory').scrollIntoView({ behavior: 'smooth' });
            break;
          case "pledge":
            window.location.href = "investment_plans.html";
            break;
          case "transfer":
            alert("Transfer funds to another account\n\nContact on WhatsApp +1 978 505 3319 !");
            break;
          case "defi":
            alert("Participate in DeFi mining pools\n\nContact on WhatsApp +1 978 505 3319 !");
            break;
          case "liquidity":
            alert("Liquidity Mining\n\nContact the admin on WhatsApp +1 978 505 3319 !");
            break;
        }
      }

      function investInPlan(planId, minAmount) {
         // Placeholder function logic.
         showActionNotification(`Investment in ${planId} plan for minimum ${formatter.format(minAmount)} requested.`, "warning");
      }
      
      function logout() {
        localStorage.removeItem("token");
        localStorage.removeItem("userId");
        localStorage.removeItem("userType");
        localStorage.removeItem("username");
        window.location.href = "user_login.html";
      }

      // --- INITIALIZATION ---
      window.onload = () => {
        fetchUserData();
        // Since we are polling for real-time updates, refresh data every 10 seconds
        setInterval(fetchUserData, 10000);
      };
    </script>
  </body>
</html>
